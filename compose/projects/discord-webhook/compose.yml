services:
  discord-webhook:
    image: ghcr.io/shiron-dev/discord-webhook:latest
    container_name: discord-webhook
    restart: unless-stopped
    security_opt:
      - no-new-privileges:true
    cap_drop:
      - ALL
    healthcheck:
      test:
        - CMD
        - python
        - -c
        - "from pathlib import Path; raise SystemExit(0 if 'main.py' in Path('/proc/1/cmdline').read_text() else 1)"
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 10s
    environment:
      - DISCORD_BOT_TOKEN={{ .discord_bot_token }}
      - WEBHOOK_URLS={{ .webhook_urls }}
